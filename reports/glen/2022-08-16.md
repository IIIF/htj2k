# Test run 18th August 2022

I will be using this document to detail the tests and scripts I ran to check htj2k decoding speeds against jp2 and ptiff. 


## Step 1: Source images

I am going to be using the same images and image URLs that Ruven has supplied and they can be found in:

[iiif_urls.txt](../../data/50_images/iiif_urls.txt)

To get the image names I ran:

```
cat data/50_images/iiif_urls.txt |awk -F\/ '{ print $1}' |sort |uniq  > data/image_list_50.txt
```

which created the [image_list_50.txt](../../data/50_images/image_list_50.txt) file which is a unique list of 50 filenames from the Getty collection of images. To download them I used the [imagelist.py](../../download/README.md) script as follows:

```
python imagelist.py ../data/50_images/image_list.txt ../imgs/50/original/
```

## Step 2: Generate the jp2, htj2k and ptiff derivatives 

I am going to use the convert.sh script but not I found an issue that the Mac date doesn't create Nano seconds so can't be used to do the timings. I've added a check to the convert script which will make sure you are using the GNU date. If not it won't make the log files.


PTiffs:

```
./convert/convert.sh imgs/50/original/ imgs/50/ptiff/lossy/ ptiff_lossy reports/glen/convert_logs 1
./convert/convert.sh imgs/50/original/ imgs/50/ptiff/lossless ptiff_lossless reports/glen/convert_logs 1
```




Compiling kakadu:


```
unzip v8_2_1-02075E.zip 
cd v8_2_1-02075E
```

Followed these instructions: https://github.com/IIIF/htj2k/tree/main/image_server 

```
cd make
make -f Makefile-Mac-x86-64-gcc clean
make -f Makefile-Mac-x86-64-gcc all_but_jni
```

Added the following to my path:

```
htj2k/image_server/kakadu/v8_2_1-02075E/bin/Mac-x86-64-gcc
```

Cheated with the library loading:

```
GDMR-MBP:convert gmr$ ln -s ~/development/htj2k/image_server/kakadu/v8_2_1-02075E/lib ../../lib
```


